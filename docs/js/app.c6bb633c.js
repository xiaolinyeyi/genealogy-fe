(function(){"use strict";var e={349:function(e,t,l){var a=l(963),n=l(252),i=l(577);const o={key:0};function r(e,t,l,a,r,s){const u=(0,n.up)("navigation-bar"),d=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)(n.HY,null,[e.title?((0,n.wg)(),(0,n.iD)("h1",o,(0,i.zw)(e.title),1)):(0,n.kq)("",!0),(0,n._)("input",{type:"file",accept:".json",onChange:t[0]||(t[0]=(...e)=>s.handleSelectFile&&s.handleSelectFile(...e)),style:(0,i.j5)({float:null==e.title?"center":"right"})},null,36),(0,n._)("div",null,[e.allPeople?((0,n.wg)(),(0,n.j4)(u,{key:0})):(0,n.kq)("",!0),(0,n.Wm)(d)])],64)}const s=(0,n.Uk)("家族介绍"),u=(0,n.Uk)("家族传承"),d=(0,n.Uk)("家庭详情"),h=(0,n.Uk)("供案"),c=(0,n.Uk)("关于");function p(e,t,l,a,i,o){const r=(0,n.up)("el-menu-item"),p=(0,n.up)("el-menu");return(0,n.wg)(),(0,n.j4)(p,{mode:"horizontal","default-active":e.$route.path,router:"true"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{index:"/home"},{default:(0,n.w5)((()=>[s])),_:1}),(0,n.Wm)(r,{index:"/tree"},{default:(0,n.w5)((()=>[u])),_:1}),(0,n.Wm)(r,{index:"/table"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(r,{index:"/sacrifice"},{default:(0,n.w5)((()=>[h])),_:1}),(0,n.Wm)(r,{index:"/about"},{default:(0,n.w5)((()=>[c])),_:1})])),_:1},8,["default-active"])}var f={},m=l(744);const g=(0,m.Z)(f,[["render",p]]);var b=g,y=l(262),w={name:"App",data:function(){return{allPeople:null,title:null}},components:{NavigationBar:b},created:function(){this.createCacheIfNeeded();let e=JSON.parse(localStorage.getItem("lastGenealogy"));void 0!=e&&this.initGlobalVarsWithJSON(e),console.log("creating!!!"),console.log(e)},setup(){const e=(0,y.qj)({meta:{},baseInfo:{},allPeople:{},about:{}});return(0,n.JJ)("globalVars",e),{globalVars:e}},methods:{createCacheIfNeeded:function(){let e=JSON.parse(localStorage.getItem(this.cacheKey)),t=!1;void 0==e&&(e=new Map,t=!0),void 0==e.local&&(e.local=new Map,t=!0),t&&localStorage.setItem(this.cacheKey,JSON.stringify(e))},handleSelectFile:function(e){const t=e.target.files[0];if(void 0==t)return;const l=this,a=new FileReader;a.onload=function(e){const t=e.target.result,a=JSON.parse(t);l.initGlobalVarsWithJSON(a),localStorage.setItem("lastGenealogy",JSON.stringify(a))},a.readAsText(t)},initGlobalVarsWithJSON:function(e){this.globalVars.meta=e["meta"],this.title=this.globalVars.meta["title"],this.globalVars.baseInfo=e["baseInfo"];const t=e["allPeople"];let l=new Map;for(var a=0;a<t.length;a++){let e=t[a];l[e.id]=e}this.globalVars.allPeople=l,this.allPeople=l,this.globalVars.about=e["about"]}}};const v=(0,m.Z)(w,[["render",r]]);var D=v,k=l(923),O=(l(415),l(201));const _=e=>((0,n.dD)("data-v-e1cc37e4"),e=e(),(0,n.Cn)(),e),S={key:0},I={key:0},P=_((()=>(0,n._)("h2",null,"字辈表",-1)));function x(e,t,l,a,o,r){const s=(0,n.up)("el-table-column"),u=(0,n.up)("el-table"),d=(0,n.up)("el-col"),h=(0,n.up)("el-row");return(0,n.wg)(),(0,n.iD)(n.HY,null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.baseInfo,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{key:t},["string"==typeof e&&""!=e?((0,n.wg)(),(0,n.iD)("div",S,[(0,n._)("h2",null,(0,i.zw)(t),1),(0,n._)("div",null,(0,i.zw)(e),1)])):(0,n.kq)("",!0)])))),128)),o.zibei?((0,n.wg)(),(0,n.iD)("div",I,[P,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.isMobile?[0,1]:[0],(e=>((0,n.wg)(),(0,n.j4)(h,{gutter:10,key:e},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.isMobile?[0,1]:[0,1,2,3],(t=>((0,n.wg)(),(0,n.j4)(d,{span:o.isMobile?10:6,key:t},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{data:this.getZibeiByGroup(2*e+t),border:!0},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{prop:"gen",label:"代数"}),(0,n.Wm)(s,{prop:"name",label:"辈字"})])),_:2},1032,["data"])])),_:2},1032,["span"])))),128))])),_:2},1024)))),128))])):(0,n.kq)("",!0)],64)}var N={data(){return{baseInfo:null,zibei:null,isMobile:!1}},created(){const e=(0,n.f3)("globalVars");return(0,n.YP)((()=>e.baseInfo),(e=>{const t=JSON.parse(JSON.stringify(e));this.baseInfo=t,this.zibei=t["字辈表"]})),{globalVars:e}},methods:{getZibeiByGroup:function(e){let t=[];for(var l=10*e;l<10*(e+1);l++)t.push({gen:"第"+(l+1)+"代",name:this.zibei[l]});return t}},mounted(){console.log("home mounted"),window.innerWidth<=768?this.isMobile=!0:this.isMobile=!1;const e=(0,n.f3)("globalVars"),t=JSON.parse(JSON.stringify(e.baseInfo));this.baseInfo=t,this.zibei=t["字辈表"]}};const W=(0,m.Z)(N,[["render",x],["__scopeId","data-v-e1cc37e4"]]);var J=W;const V={style:{width:"100vw",height:"100vh"}},j={style:{width:"20px",height:"75px"}},z={key:1},F={key:1},Y=(0,n._)("div",{style:{height:"200px"}},null,-1);function C(e,t,l,a,o,r){const s=(0,n.up)("router-link"),u=(0,n.up)("vue3-tree-org"),d=(0,n.up)("el-scrollbar");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n._)("div",V,[o.rootNode?((0,n.wg)(),(0,n.j4)(u,{key:0,data:o.rootNode,disabled:!0,horizontal:!1,collapsable:!1,scalable:!1,style:{margin:"20px"}},{default:(0,n.w5)((({node:e})=>[(0,n._)("div",j,[r.peopleIsFamilyOwnerWithID(e.id)?((0,n.wg)(),(0,n.j4)(s,{key:0,to:{name:"table",query:{id:e.id}}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.label),1)])),_:2},1032,["to"])):((0,n.wg)(),(0,n.iD)("div",z,(0,i.zw)(e.label),1))])])),_:1},8,["data"])):((0,n.wg)(),(0,n.iD)("div",F,"数据加载中"))])])),_:1}),Y],64)}class H{constructor(e){if(null==e)return null;this.metadata=e,this.id=e.id,this.genID=e.genID,this.name=e.name,this.sexDes=this.sexDes(),this.nativePlace=e.nativePlace,this.birthdayDes=this.birthdayDes(),this.deathdayDes=this.deathdayDes(),this.educational=e.educational,this.lastJob=this.lastJob(),this.lastHabitation=this.lastHabitation(),this.extDes=this.extDes()}isFamilyOwner(){return 0!=this.metadata.sex&&(null!=this.metadata.spouses&&this.metadata.spouses.length>0||null!=this.metadata.children&&this.metadata.children.length>0)}isDead(){return void 0!=this.deathdayDes&&""!=this.deathdayDes}sexDes(){return 0==this.metadata.sex?"女":"男"}birthdayDes(){if(null!=this.metadata.ext&&null!=this.metadata.ext[0]["birthday"])return this.metadata.ext[0]["birthday"];if(null==this.metadata.birthday)return"不详";{let e=new Date(this.metadata.birthday.date);return e.getFullYear()}}deathdayDes(){if(null!=this.metadata.deathday){let e=new Date(this.metadata.deathday.date);return e.getFullYear()}if(null==this.metadata.birthday)return"number"!=typeof this.birthdayDes&&this.metadata.genID<6?"不详":"";{let e=new Date(this.metadata.birthday.date).getFullYear(),t=(new Date).getFullYear();if(t-e>100)return"不详"}}lastPost(){const e=this.metadata.posts;return void 0==e?"":e[e.length-1]}lastJob(){const e=this.metadata.jobs;return void 0==e?"":e[e.length-1]}lastHabitation(){const e=this.metadata.habitation;return void 0==e?"":e[e.length-1]}extDes(){let e="";const t=this.metadata;return null!=t.politicalStatus&&(e=e+"【政治面貌】"+t.politicalStatus+"\n"),null!=t.posts&&(e=e+"【历任职务】"+t.posts[t.posts.length-1]+"\n"),null!=t.note&&(e=e+"【备注】"+t.note+"\n"),e}isSameFamily(){return 1==this.id||void 0!=this.metadata.fatherID}}var q=H,M={data(){return{allPeople:null,rootNode:null}},created(){console.log("tree created");const e=(0,n.f3)("globalVars");return this.allPeople=JSON.parse(JSON.stringify(e.allPeople)),(0,n.YP)((()=>e.allPeople),(e=>{console.log("tree watch"),this.allPeople=JSON.parse(JSON.stringify(e));const t=this.generatePeopleNode(this.allPeople);this.rootNode=t})),{globalVars:e}},mounted(){console.log("tree mounted"),this.rootNode=this.generatePeopleNode(this.allPeople)},methods:{groupByGen:function(e){var t=new Map;for(var l in e){const a=e[l];if(null==a.genID)continue;let n=void 0!=a.fatherID&&0!=a.fatherID;(n||1==a.id)&&(null==t[a.genID]&&(t[a.genID]=new Array),t[a.genID].push(a.id))}return t},peopleIsFamilyOwnerWithID:function(e){if(void 0==e)return!1;let t=this.allPeople[e.toString()],l=new q(t);return l.isFamilyOwner()},generatePeopleNode:function(e){if(void 0==e)return;let t=new Map,l=this.groupByGen(e),a=Object.keys(l).length;for(let n=a;n>0;n--){let a=l[n];for(let l=0;l<a.length;l++){let n=e[a[l].toString()],i={label:n.name,id:n.id,isOwner:this.peopleIsFamilyOwnerWithID(n.id)};if(void 0!=n.children){let e=[];for(let l=0;l<n.children.length;l++)e.push(t[n.children[l]]),delete t[n.children[l]];i["children"]=e}t[n.id]=i}}return t[1]},snap:function(){console.log("snap")}}};const U=(0,m.Z)(M,[["render",C]]);var Z=U;const A={key:0},G={style:{"text-align":"left"}},B={key:0},K=(0,n.Uk)("上一代户主： "),T={key:1},Q={key:1};function E(e,t,l,a,o,r){const s=(0,n.up)("router-link"),u=(0,n.up)("el-table-column"),d=(0,n.up)("el-table");return o.family?((0,n.wg)(),(0,n.iD)("div",A,[(0,n._)("div",G,[(0,n._)("div",null,"赵氏第 "+(0,i.zw)(o.family.owner.genID)+" 代",1),o.family.father?((0,n.wg)(),(0,n.iD)("div",B,[K,(0,n.Wm)(s,{to:{name:"table",query:{id:o.family.father.id}},onClick:t[0]||(t[0]=e=>r.familyOwnerDidClick(o.family.father.id))},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.family.father.name),1)])),_:1},8,["to"])])):(0,n.kq)("",!0),(0,n._)("div",null,"户主："+(0,i.zw)(o.family.owner.name),1)]),(0,n._)("div",null,[(0,n.Wm)(d,{data:r.tableData,style:{width:"100%"},border:""},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{prop:"name",label:"姓名"},{default:(0,n.w5)((e=>[e.row.id!=this.family.owner.id&&e.row.isFamilyOwner()?((0,n.wg)(),(0,n.j4)(s,{key:0,to:{name:"table",query:{id:e.row.id}},onClick:t=>r.familyOwnerDidClick(e.row.id)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.row.name),1)])),_:2},1032,["to","onClick"])):((0,n.wg)(),(0,n.iD)("span",T,(0,i.zw)(e.row.name),1))])),_:1}),(0,n.Wm)(u,{prop:"birthdayDes",label:"生日"}),(0,n.Wm)(u,{prop:"sexDes",label:"性别"}),(0,n.Wm)(u,{prop:"relationship",label:"户主关系"}),(0,n.Wm)(u,{prop:"educational",label:"\t文化程度"}),(0,n.Wm)(u,{prop:"lastJob",label:"从事职业"}),(0,n.Wm)(u,{prop:"nativePlace",label:"籍贯"}),(0,n.Wm)(u,{prop:"lastHabitation",label:"居住地"}),(0,n.Wm)(u,{prop:"spouses",label:"婚姻"}),(0,n.Wm)(u,{prop:"deathdayDes",label:"故时"}),(0,n.Wm)(u,{prop:"extDes",label:"更多"})])),_:1},8,["data"])])])):((0,n.wg)(),(0,n.iD)("div",Q,"数据加载中"))}class R{constructor(e,t){if(null==e||void 0==e||0==Object.keys(e).length)return null;const l=e[t];let a=new q(l);if(null==a||0==a.sex)return null;a.relationship="户主",this.owner=a;var n=null;null!=l.fatherID&&(n=new q(e[l.fatherID.toString()])),this.father=n;var i=null;null!=l.motherID&&(i=new q(e[l.motherID.toString()])),this.mother=i;var o=null;if(null!=l.spouses&&l.spouses.length>0){o=new Array;for(let t=0;t<l.spouses.length;t++){const a=l.spouses[t];let n=new q(e[a.id.toString()]);if(null!=n){n.relationship="夫妻";let e="";null!=a.time&&(e=e+"【时间】"+a.time+"\n"),null!=a.place&&(e=e+"【地址】"+a.place+"\n"),o.push(n)}}}this.marriage=o;var r=null;if(null!=l.children&&l.children.length>0){r=new Array;for(let t=0;t<l.children.length;t++){const a=l.children[t];let n=new q(e[a.toString()]);if(null!=n){if(n.relationship=0==n.metadata.sex?"女":"子",null!=n.metadata.spouses){let t=n.metadata.spouses[n.metadata.spouses.length-1],l="";null!=t.id&&(l=l+"【姓名】"+e[t.id.toString()].name+"\n"),null!=t.time&&(l=l+"【时间】"+t.time+"\n"),null!=t.place&&(l=l+"【地址】"+t.place+"\n"),n.spouses=l}r.push(n)}}}this.children=r}}var $=R,L={data(){return{globalVars:null,family:null}},computed:{tableData:function(){let e=new Array;return e.push(this.family.owner),null!=this.family.marriage&&e.push(...this.family.marriage),null!=this.family.children&&e.push(...this.family.children),e}},created(){console.log("table created");const e=(0,n.f3)("globalVars");return this.globalVars=e,(0,n.YP)((()=>e.allPeople),(()=>{console.log("table watch"),this.updateFamilyByQuery()})),{globalVars:e}},mounted(){console.log("table mounted"),null!=this.allPeople()&&this.updateFamilyByQuery()},methods:{allPeople(){if(Object.keys(this.globalVars.allPeople).length>0){const e=JSON.parse(JSON.stringify(this.globalVars.allPeople));return e}return null},updateFamilyByQuery(){if(void 0==(0,O.yj)())return void console.log("route is null");let e=(0,O.yj)().query.id;void 0==e&&(e="1");const t=this.allPeople();this.family=new $(t,e)},familyOwnerDidClick(e){const t=this.allPeople();this.family=new $(t,e.toString())}}};const X=(0,m.Z)(L,[["render",E]]);var ee=X;const te={class:"label"};function le(e,t,l,a,o,r){const s=(0,n.up)("el-col"),u=(0,n.up)("el-row"),d=(0,n.up)("el-timeline-item"),h=(0,n.up)("el-timeline");return(0,n.wg)(),(0,n.j4)(h,{style:{"margin-top":"10px"}},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.ancestors,((e,t)=>((0,n.wg)(),(0,n.j4)(d,{key:t},{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,((e,t)=>((0,n.wg)(),(0,n.j4)(s,{span:1,key:t},{default:(0,n.w5)((()=>[(0,n._)("div",te,(0,i.zw)(e.name),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})}var ae={data(){return{globalVars:null,ancestors:[]}},created(){const e=(0,n.f3)("globalVars");return this.globalVars=e,(0,n.YP)((()=>e.allPeople),(()=>{this.createSacrificeArr()})),{globalVars:e}},mounted(){this.createSacrificeArr()},methods:{allPeople(){if(Object.keys(this.globalVars.allPeople).length>0){const e=JSON.parse(JSON.stringify(this.globalVars.allPeople));return e}return null},createSacrificeArr(){this.ancestors=[];const e=this.allPeople();for(const l in e){const a=e[l];let n=new q(a);if(void 0!=n.genID&&("女"!==n.sexDes&&n.isDead())){var t=this.ancestors[n.genID-1];void 0==t?t=[n]:t.push(n),this.ancestors[n.genID-1]=t}}}}};const ne=(0,m.Z)(ae,[["render",le],["__scopeId","data-v-1c4d7bf8"]]);var ie=ne;const oe=e=>((0,n.dD)("data-v-d6b4010a"),e=e(),(0,n.Cn)(),e),re=oe((()=>(0,n._)("div",null,[(0,n._)("h2",null,"数据说明"),(0,n.Uk)(" 本页面仅解析、展示家谱数据，不做数据存储。请家谱管理员妥善保存家谱数据 ")],-1))),se={key:0},ue=oe((()=>(0,n._)("h2",null,"家谱管理员",-1))),de=oe((()=>(0,n._)("div",null,[(0,n._)("h2",null,"技术支持"),(0,n.Uk)(" xk_zhao@outlook.com ")],-1))),he={key:1,style:{"text-align":"center","margin-top":"20px",color:"dimgray"}};function ce(e,t,l,a,o,r){const s=(0,n.up)("el-table-column"),u=(0,n.up)("el-table");return(0,n.wg)(),(0,n.iD)(n.HY,null,[re,o.about?((0,n.wg)(),(0,n.iD)("div",se,[ue,(0,n.Wm)(u,{data:r.contacts,style:{width:"30%"},border:"",stripe:""},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{prop:"name",label:"姓名"}),(0,n.Wm)(s,{prop:"phone",label:"电话"})])),_:1},8,["data"])])):(0,n.kq)("",!0),de,o.about?((0,n.wg)(),(0,n.iD)("div",he,"家谱更新于"+(0,i.zw)(r.updateTime),1)):(0,n.kq)("",!0)],64)}var pe={data(){return{about:null}},computed:{updateTime:function(){return this.about["updateTime"]},contacts:function(){return this.about["contacts"]}},created(){const e=(0,n.f3)("globalVars");return(0,n.YP)((()=>e.about),(e=>{this.about=JSON.parse(JSON.stringify(e)),console.log(this.about)})),{globalVars:e}},methods:{},mounted(){console.log("about mounted");const e=(0,n.f3)("globalVars");this.about=JSON.parse(JSON.stringify(e.about)),console.log(this.about.updateTime)}};const fe=(0,m.Z)(pe,[["render",ce],["__scopeId","data-v-d6b4010a"]]);var me=fe;const ge=[{path:"/",redirect:"/home"},{path:"/home",name:"home",component:J},{path:"/tree",name:"tree",component:Z},{path:"/table",name:"table",component:ee},{path:"/sacrifice",name:"sacrifice",component:ie},{path:"/about",name:"about",component:me}],be=(0,O.p7)({history:(0,O.PO)(""),routes:ge});var ye=be,we=l(342);(0,a.ri)(D).use(k.Z).use(ye).use(we.Z).mount("#app")}},t={};function l(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,l),i.exports}l.m=e,function(){var e=[];l.O=function(t,a,n,i){if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],i=e[d][2];for(var r=!0,s=0;s<a.length;s++)(!1&i||o>=i)&&Object.keys(l.O).every((function(e){return l.O[e](a[s])}))?a.splice(s--,1):(r=!1,i<o&&(o=i));if(r){e.splice(d--,1);var u=n();void 0!==u&&(t=u)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[a,n,i]}}(),function(){l.d=function(e,t){for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};l.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,i,o=a[0],r=a[1],s=a[2],u=0;if(o.some((function(t){return 0!==e[t]}))){for(n in r)l.o(r,n)&&(l.m[n]=r[n]);if(s)var d=s(l)}for(t&&t(a);u<o.length;u++)i=o[u],l.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return l.O(d)},a=self["webpackChunkgenealogy"]=self["webpackChunkgenealogy"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=l.O(void 0,[998],(function(){return l(349)}));a=l.O(a)})();
//# sourceMappingURL=app.c6bb633c.js.map